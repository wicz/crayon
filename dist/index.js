!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var s in n)("object"==typeof exports?exports:t)[s]=n[s]}}(window,(function(){return function(t){var e={};function n(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(s,r,function(e){return t[e]}.bind(null,r));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){window,t.exports=function(t){var e={};function n(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(s,r,function(e){return t[e]}.bind(null,r));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);const s={ofLength:function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=n.length,r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*s));return e}};var r=s;const i=(t,e)=>new Promise(n=>{let s=0;const r=t.subscribe(t=>{++s===e&&(n(t),r.unsubscribe())})}),o=(t,e=(()=>!0))=>new Promise(n=>{const s=t.subscribe(t=>{!0===e(t)&&(n(t),s.unsubscribe())})}),a={Bundle:class{constructor(){this.subscriptions=[]}add(t){this.subscriptions.push(t)}unsubscribe(){this.subscriptions.forEach(t=>t.unsubscribe()),this.subscriptions=[]}},Beacon:class{constructor(){this.subscribers={}}subscribe(t){const e=s.ofLength(5);return this.subscribers[e]=t,{unsubscribe:()=>delete this.subscribers[e]}}next(t){for(const e in this.subscribers)this.subscribers[e](t)}first(t=(()=>!0)){return o(this,t)}nthEvent(t){return i(this,t)}},nthEvent:i,first:o};var u=a;const c={isArray:t=>!!t&&(Array.isArray?Array.isArray(t):t&&"object"==typeof t&&t.constructor===Array)};var h=c;const d=(t,e)=>{for(const n in e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},l=(t,e)=>{for(const n in e)e.hasOwnProperty(n)||(t[n]=e[n])},f={create:(t={},...e)=>{const n=document.createElement(t.tag||"div");t.id&&(n.id=t.id),t.className&&(n.classList.value=t.className),t.cssText&&(n.style.cssText=t.cssText),t.styles&&d(n,t.styles),t.innerHTML&&(n.innerHTML=t.innerHTML),t.innerText&&(n.innerText=t.innerText),t.events&&l(n,t.events);for(const t of e)n.appendChild(t);return n},setStyles:d,setEvents:l,addClassNames:(t,e)=>{for(const n of e)t.classList.add(n)},removeClassNames:(t,e)=>{for(const n of e)t.classList.remove(n)},clearClassList:t=>t&&t.className&&(t.className=""),waitForElements:(...t)=>t.forEach(t=>t.getBoundingClientRect())};var p=f;const m={exec:(t,e=0)=>new Promise(n=>setTimeout(()=>{const e=t();n(e)},e)),duration:(t=0)=>new Promise(e=>setTimeout(()=>{e()},t))};var v=m;const g=(t,e=!0)=>t&&"/"!==t?(t.startsWith("/")||(t="/"+t),t=y(t),e&&(t=t.toLowerCase()),t):"/",y=t=>(w(t)&&(t=t.substring(0,t.length-1)),t),w=t=>"/"==t.substring(t.length-1),b={normalise:g,removeTrailingSlash:y,hasTrailingSlash:w,matchPath:(t,e)=>{e=g(e,!1).split("?")[0];const n={},s=(t=g(t)).split("/"),r=e.split("/");if(s.length===r.length||t.includes("**")){for(const t in s)if(s[t].startsWith(":")&&"/"!==e)n[s[t].slice(1)]=r[t].toString();else{if(s[t].startsWith("**"))return n;if(s[t]!==r[t].toLowerCase())return}return n}},deserializeQuery:(t="")=>{if(!t.startsWith("?"))return{};var e=t.slice(1).split("&"),n={};for(const t of e){const e=t.split("=");e[0]&&(n[e[0]]=decodeURIComponent(e[1]||""))}return n}};var R=b;n.d(e,"eventStream",(function(){return a})),n.d(e,"checkType",(function(){return c})),n.d(e,"element",(function(){return f})),n.d(e,"genString",(function(){return s})),n.d(e,"sleep",(function(){return m})),n.d(e,"url",(function(){return b})),e.default={eventStream:u,checkType:h,element:p,genString:r,sleep:v,url:R}}])},function(t,e,n){"use strict";n.r(e);class s{constructor(t){this.base=t,this.middleware=[],this.routes={}}path(t,...e){this.routes[t]=e}use(t){this.middleware.push(t)}}class r{constructor(t,e,n,s,r,i,o,a,u,c,h={},d={}){this.routePattern=t,this.hash=e,this.host=n,this.hostname=s,this.href=r,this.origin=i,this.pathname=o,this.port=a,this.protocol=u,this.search=c,this.params=h,this.query=d}}class i{constructor(){this.ctx={},this.hasCompleted=!1,this.leaveActions=[]}runOnLeave(){this.leaveActions.forEach(t=>t()),this.leaveActions=[]}onLeave(t){this.leaveActions.push(t)}end(){this.hasCompleted=!0}unmount(...t){console.log("Unmount action is not set"),console.log(...t)}mount(...t){console.log("Mount action is not set"),console.log(...t)}redirect(t){console.log("Redirect action is not set"),console.log(t)}}var o,a=n(0);!function(t){t.History="HISTORY_EVENT",t.LoadTriggered="ROUTER_LOAD_TRIGGERED",t.ProgressStart="ROUTER_START",t.ProgressEnd="ROUTER_END",t.RunningHanlders="ROUTER_RUNNING_HANDLERS",t.NoHanlders="ROUTER_NO_HANDLERS",t.SameRouteAbort="ROUTER_SAME_ROUTE_ABORT",t.Redirected="ROUTER_REDIRECTED",t.Destroyed="ROUTER_DESTROYED",t.Registered="ROUTER_REGISTERED",t.Unregistered="ROUTER_UNREGISTERED"}(o||(o={}));class u{constructor(t,e,n,s,r){this.id=t,this.locator=e,this.routeMap=n,this.history=s,this.events=r,this.isLoading=!0,this.state={},this.$reqs=[],this.loads=0,this.onHistoryEvent=t=>{this.emitEvent(o.History,{...t}),this.digest()},this.onRedirect=t=>{this.isLoading=!1,this.emitEvent(o.Redirected),this.emitEvent(o.ProgressEnd),this.history.push(t)},this.$history=this.history.onEvent.subscribe(this.onHistoryEvent)}destroy(){this.$history.unsubscribe(),this.$reqs.forEach(t=>t.unsubscribe()),this.currentRes&&(this.currentRes.runOnLeave(),this.currentRes.unmount()),this.emitEvent(o.Destroyed)}path(t,...e){this.routeMap.add(t,...e)}use(t){t instanceof s?this.useGroup(t):this.routeMap.addMiddleware(t)}async navigate(t){this.isLoading||this.history.push(t)}async back(){this.isLoading||this.history.pop()}load(){return this.emitEvent(o.LoadTriggered),this.digest()}useGroup(t){for(const e in t.routes){const n=a.url.normalise(t.base+e),s=[...t.middleware,...t.routes[e]];this.routeMap.add(n,...s)}}emitEvent(t,e){e||(e=this.locator.getLocation().pathname),this.events.next({id:this.id,type:t,data:e})}async runHandlers(t,e,n){for(const s of t){if(n.hasCompleted)break;await s(e,n,this.state,this)}}async digest(){this.emitEvent(o.ProgressStart),this.isLoading=!0;const t=this.locator.getLocation(),e=new i;e.redirect=t=>{e.hasCompleted=!0,this.onRedirect(t)};const n=this.routeMap.findWithPathname(t.pathname);if(!n)return this.emitEvent(o.NoHanlders),this.emitEvent(o.ProgressEnd),void(this.isLoading=!1);const{handlers:s,pattern:r,params:a}=n,u=this.locator.generateRequest(r,a);if(this.history.currentEvent&&0!==this.loads){const t=this.routeMap.findWithPathname(this.history.currentEvent.from);if(r===(t&&t.pattern))return void this.emitEvent(o.SameRouteAbort)}this.$reqs.push(this.onRequestUpdate(u,e,r)),this.emitEvent(o.RunningHanlders),await this.runHandlers(s,u,e),this.loads++,this.isLoading=!1,this.currentRes=e,this.emitEvent(o.ProgressEnd)}onRequestUpdate(t,e,n){return this.history.onEvent.subscribe(s=>{const r=this.routeMap.findWithPathname(s.to),i=this.routeMap.findWithPathname(s.from);if((r&&r.pattern)!==(i&&i.pattern))return this.$reqs[0].unsubscribe(),this.$reqs.shift(),void e.runOnLeave();const u=a.url.matchPath(n,t.pathname),c=this.locator.generateRequest(n,u);Object.assign(t,c),this.emitEvent(o.ProgressEnd,{path:c.pathname,note:"Router ended after same-route update",route:n}),this.isLoading=!1})}}class c{constructor(t="crayon"){this.base=t,this.isAnimating="is-animating",this.noAnimation="no-animation",this.hostView="host-view",this.firstEnter=`${t}-enter-first`,this.enter=`${t}-enter`,this.enterDone=`${t}-enter-done`,this.exit=`${t}-exit`}}const h=(t,e,n)=>!(!e||!n||e===t||0===n),d=t=>{const e=document.body.getElementsByClassName(t);return 1===e.length?{length:1,entering:e[0],leaving:void 0}:{length:2,leaving:e[0],entering:e[1]}},{addClassNames:l,removeClassNames:f,clearClassList:p,setStyles:m,waitForElements:v}=a.element,g=async(t,e,n,s,r)=>{const i=n.target;await n.push(e);const{leaving:o,entering:u}=d(n.selector);if(l(u,[s]),l(i,[t.isAnimating]),m(u,{transitionDuration:"0ms"}),l(u,[t.base]),v(u,i),m(u,{transitionDuration:`${r}ms`}),void 0===o)return l(u,[t.firstEnter]),l(u,[t.enter]),v(u),await a.sleep.duration(r),f(u,[t.firstEnter]),f(u,[t.enter]),l(u,[t.enterDone]),void f(i,[t.isAnimating]);p(o),m(o,{transitionDuration:`${r}ms`}),l(o,[n.selector]),v(o,u),l(o,[t.base]),l(o,[t.exit]),l(u,[t.enter]),v(o,u),await a.sleep.duration(r),f(u,[t.enter]),l(u,[t.enterDone]),f(i,[t.isAnimating]),await n.shift()},{addClassNames:y,removeClassNames:w,clearClassList:b,setStyles:R,waitForElements:E}=a.element,T=async(t,e,n,s)=>{await n.push(e);const{leaving:r,entering:i}=d(n.selector);y(i,[s]),E(i),void 0!==r?await n.shift():y(i,[t.enterDone])},S=async(t,e,n,s)=>{const r=new c(n);return h(r.noAnimation,n,s)?g(r,t,e,n,s):T(r,t,e,n)};var L;!function(t){t.push="PUSH",t.back="BACK",t.forward="FORWARD",t.replace="REPLACE"}(L||(L={}));class O{constructor(t=t){this.window=t,this.entries=[],this.events=[],this.onEvent=new a.eventStream.Beacon,this.onPop=()=>{const t=this.window.location.pathname;if(t===this.lastRoute){const t={type:L.back,from:this.currentRoute,to:this.lastRoute};this.entries.pop(),this.events.push(t),this.onEvent.next(t)}else{const e={type:L.forward,from:this.currentRoute,to:t};this.entries.push(t),this.events.push(e),this.onEvent.next(e)}},this.document=this.window.document,this.entries.push(this.window.location.pathname),this.window.addEventListener("popstate",this.onPop)}get lastEvent(){return this.events[this.events.length-2]}get currentEvent(){return this.events[this.events.length-1]}get lastRoute(){return this.entries[this.entries.length-2]}get currentRoute(){return this.entries[this.entries.length-1]}destroy(){this.window.removeEventListener("popstate",this.onPop)}push(t){t=a.url.normalise(t,!1),this.window.history.pushState(null,this.document.title,t);const e={type:L.push,from:this.currentRoute,to:t};this.entries.push(t),this.events.push(e),this.onEvent.next(e)}pop(){this.window.history.back()}replace(t){t=a.url.normalise(t,!1),this.window.history.replaceState(null,this.document.title,t),this.entries[this.entries.length-1]=t,this.onEvent.next({type:L.replace,from:this.currentRoute,to:t})}}class P{constructor(t=t){this.window=t}getLocation(){return{...this.window.location}}generateRequest(t,e){const n=a.url.deserializeQuery(this.window.location.search);return new r(t,this.window.location.hash,this.window.location.host,this.window.location.hostname,this.window.location.href,this.window.location.origin,this.window.location.pathname,this.window.location.port,this.window.location.protocol,this.window.location.search,{...e},n)}}class x{constructor(){this.middleware=[],this.routes={}}add(t,...e){this.routes[a.url.normalise(t)]=e}addMiddleware(...t){for(const e of t)this.middleware.push(e)}findWithPathname(t){let e=[];for(let n in this.routes){const s=a.url.matchPath(n,t);void 0!==s&&e.push({key:n,params:s})}if(0===e.length)return;const n=e.filter(t=>t.key.includes("**")),s=e.filter(t=>!t.key.includes("**"));let r,i;for(let e of s)if(r=e.key,i=e.params,e.key===t)break;if(!r||!i&&n.length){const t=n[0].key,s=[...this.middleware,...this.routes[t]];return{params:n[0].params,pattern:t,patterns:e,handlers:s}}if(!r||!i)return;return{params:i,pattern:r,patterns:e,handlers:[...this.middleware,...this.routes[r]]}}}class A{constructor(t){this.history=t,this.routers={},this.events=new a.eventStream.Beacon}addRouter(t){this.routers[t.id]=t,this.events.next({type:o.Registered,id:t.id})}removeRouter(t){delete this.routers[t.id],0===Object.keys(this.routers).length&&(this.events.next({type:o.Unregistered,id:t.id}),this.history.destroy())}}const M=(t=window)=>{if(void 0!==t.crayon)return t.crayon},_=(t,e=window)=>{e.crayon=t},C=(t=a.genString.ofLength(10),e=window,n)=>{if(void 0===n&&(n=M(e)),void 0===n){const t=new O(e);n=new A(t),_(n)}const s=n.history,r=new x,i=new P(e),o=new u(t,i,r,s,n.events);return n.addRouter(o),N(o,n),o},N=async(t,e)=>{await e.events.first(e=>e.type===o.Destroyed&&e.id===t.id),e.removeRouter(t)},D=(t,e)=>{const n=new s(t);return e&&e(n),n};n.d(e,"crayon",(function(){return j})),n.d(e,"Group",(function(){return s})),n.d(e,"Request",(function(){return r})),n.d(e,"Response",(function(){return i})),n.d(e,"Router",(function(){return u})),n.d(e,"RouterEventType",(function(){return o})),n.d(e,"mount",(function(){return S})),n.d(e,"hasAnimation",(function(){return h})),n.d(e,"ClassNameStates",(function(){return c})),n.d(e,"animatedMount",(function(){return g})),n.d(e,"staticMount",(function(){return T})),n.d(e,"getRouteTargets",(function(){return d})),n.d(e,"HistoryType",(function(){return L})),n.d(e,"History",(function(){return O})),n.d(e,"Locator",(function(){return P})),n.d(e,"RouteMap",(function(){return x})),n.d(e,"SharedState",(function(){return A})),n.d(e,"getSharedState",(function(){return M})),n.d(e,"setSharedState",(function(){return _})),n.d(e,"Group",(function(){return s})),n.d(e,"Request",(function(){return r})),n.d(e,"Response",(function(){return i})),n.d(e,"Router",(function(){return u})),n.d(e,"RouterEventType",(function(){return o})),n.d(e,"create",(function(){return C})),n.d(e,"group",(function(){return D}));const j={create:C,group:D};e.default=j}])}));